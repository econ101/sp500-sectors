<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S&P 500 Sectors Performance</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    min-height: 100vh;
    color: white;
    padding: 20px;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
  }

  header {
    text-align: center;
    margin-bottom: 30px;
  }

  h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
    background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .subtitle {
    color: #888;
    font-size: 1rem;
  }

  .main-content {
    display: flex;
    gap: 20px;
    align-items: stretch;
  }

  .chart-container {
    background: rgba(255,255,255,0.05);
    border-radius: 16px;
    padding: 20px;
    flex: 1;
  }

  .controls {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .toggle-btn {
    padding: 6px 12px;
    border: 2px solid;
    border-radius: 20px;
    background: transparent;
    color: white;
    cursor: pointer;
    font-size: 0.8rem;
    transition: all 0.3s;
  }

  .toggle-btn:hover {
    transform: scale(1.05);
  }

  .toggle-btn.active {
    color: white;
  }

  .toggle-btn.inactive {
    opacity: 0.4;
  }

  .stats-grid {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    width: 100px;
    flex-shrink: 0;
  }

  .stat-card {
    background: rgba(255,255,255,0.05);
    border-radius: 6px;
    padding: 6px 6px;
    text-align: center;
    transition: transform 0.3s;
  }

  .stat-card:hover {
    transform: translateX(-3px);
  }

  .stat-card .ticker {
    font-size: 0.7rem;
    font-weight: 600;
    color: #ccc;
    margin-bottom: 1px;
  }

  .stat-card .return {
    font-size: 0.9rem;
    font-weight: 700;
  }

  .stat-card .return.positive { color: #4ade80; }
  .stat-card .return.negative { color: #f87171; }

  .time-controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
  }

  .time-btn {
    padding: 6px 14px;
    border: 1px solid #444;
    border-radius: 6px;
    background: transparent;
    color: #888;
    cursor: pointer;
    transition: all 0.2s;
  }

  .time-btn:hover, .time-btn.active {
    background: #f5576c;
    border-color: #f5576c;
    color: white;
  }

  .loading {
    text-align: center;
    padding: 60px;
    color: #888;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid #333;
    border-top-color: #f5576c;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
  }

  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>S&P 500 Sectors</h1>
    <p class="subtitle">Vanguard Sector ETF Performance</p>
  </header>

  <div class="time-controls">
    <button class="time-btn active" data-days="1">1D</button>
    <button class="time-btn" data-days="7">1W</button>
    <button class="time-btn" data-days="30">1M</button>
    <button class="time-btn" data-days="90">3M</button>
    <button class="time-btn" data-days="180">6M</button>
    <button class="time-btn" data-days="ytd">YTD</button>
    <button class="time-btn" data-days="365">1Y</button>
    <button class="time-btn" data-days="1095">3Y</button>
    <button class="time-btn" data-days="1825">5Y</button>
  </div>

  <div class="controls" id="stockToggles"></div>

  <div class="main-content">
    <div class="chart-container">
      <canvas id="stockChart"></canvas>
    </div>

    <div class="stats-grid" id="statsGrid">
      <div class="loading">
        <div class="spinner"></div>
        Loading...
      </div>
    </div>
  </div>
</div>

<script>
const SECTORS = {
  'VGT': { name: 'Technology', color: '#00D4FF' },
  'VHT': { name: 'Healthcare', color: '#FF6B6B' },
  'VFH': { name: 'Financials', color: '#4ECDC4' },
  'VCR': { name: 'Consumer Disc', color: '#FFE66D' },
  'VOX': { name: 'Communication', color: '#95E1D3' },
  'VIS': { name: 'Industrials', color: '#F38181' },
  'VDC': { name: 'Consumer Staples', color: '#AA96DA' },
  'VDE': { name: 'Energy', color: '#FF9F43' },
  'VPU': { name: 'Utilities', color: '#74B9FF' },
  'VNQ': { name: 'Real Estate', color: '#A29BFE' },
  'VAW': { name: 'Materials', color: '#FD79A8' }
};

let chart = null;
let stockData = {};
let jsonData = null;
let visibleStocks = new Set(Object.keys(SECTORS));
let currentDays = 1;

// Create toggle buttons
const togglesContainer = document.getElementById('stockToggles');
Object.entries(SECTORS).forEach(([ticker, info]) => {
  const btn = document.createElement('button');
  btn.className = 'toggle-btn active';
  btn.style.borderColor = info.color;
  btn.style.background = info.color;
  btn.textContent = ticker;
  btn.onclick = () => toggleStock(ticker, btn);
  togglesContainer.appendChild(btn);
});

// Time period buttons
document.querySelectorAll('.time-btn').forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentDays = btn.dataset.days === 'ytd' ? 'ytd' : parseInt(btn.dataset.days);
    filterData();
  };
});

function toggleStock(ticker, btn) {
  if (visibleStocks.has(ticker)) {
    visibleStocks.delete(ticker);
    btn.classList.remove('active');
    btn.classList.add('inactive');
    btn.style.background = 'transparent';
  } else {
    visibleStocks.add(ticker);
    btn.classList.add('active');
    btn.classList.remove('inactive');
    btn.style.background = SECTORS[ticker].color;
  }
  updateChart();
}

async function fetchData() {
  try {
    const response = await fetch('stock_data.json');
    jsonData = await response.json();
    console.log('Loaded stock data from JSON');
    filterData();
  } catch (e) {
    console.error('Could not load stock_data.json:', e);
    document.getElementById('statsGrid').innerHTML =
      '<div class="loading">Error loading data. Make sure stock_data.json exists.</div>';
  }
}

function filterData() {
  if (!jsonData) return;

  stockData = {};

  // Special case for 1D: show last 2 trading days
  if (currentDays === 1) {
    Object.keys(SECTORS).forEach(ticker => {
      if (jsonData[ticker] && jsonData[ticker].length >= 2) {
        const allData = jsonData[ticker].map(d => ({ date: new Date(d.date), price: d.price }));
        stockData[ticker] = allData.slice(-2);
      }
    });
    updateChart();
    updateStats();
    return;
  }

  const endDate = new Date();
  let startDate;

  if (currentDays === 'ytd') {
    startDate = new Date(endDate.getFullYear(), 0, 1);
  } else {
    startDate = new Date();
    startDate.setDate(startDate.getDate() - currentDays);
  }

  Object.keys(SECTORS).forEach(ticker => {
    if (jsonData[ticker]) {
      stockData[ticker] = jsonData[ticker]
        .map(d => ({ date: new Date(d.date), price: d.price }))
        .filter(d => d.date >= startDate && d.date <= endDate);
    }
  });

  updateChart();
  updateStats();
}

function updateChart() {
  const ctx = document.getElementById('stockChart').getContext('2d');

  const datasets = Object.entries(stockData)
    .filter(([ticker]) => visibleStocks.has(ticker))
    .map(([ticker, data]) => {
      const startPrice = data[0]?.price || 1;
      return {
        label: SECTORS[ticker].name,
        data: data.map(d => ({
          x: d.date,
          y: (d.price / startPrice) * 100
        })),
        borderColor: SECTORS[ticker].color,
        backgroundColor: SECTORS[ticker].color + '20',
        borderWidth: 2.5,
        pointRadius: 0,
        pointHoverRadius: 6,
        tension: 0.1,
        fill: false
      };
    });

  if (chart) {
    chart.destroy();
  }

  chart = new Chart(ctx, {
    type: 'line',
    data: { datasets },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      aspectRatio: 2,
      interaction: {
        intersect: false,
        mode: 'index'
      },
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          backgroundColor: 'rgba(0,0,0,0.8)',
          titleColor: '#fff',
          bodyColor: '#fff',
          padding: 12,
          displayColors: true,
          callbacks: {
            label: (ctx) => {
              const value = ctx.parsed.y;
              const change = (value - 100).toFixed(2);
              const sign = change >= 0 ? '+' : '';
              return `${ctx.dataset.label}: ${sign}${change}%`;
            }
          }
        }
      },
      scales: {
        x: {
          type: 'time',
          time: { unit: 'day', displayFormats: { day: 'MMM d' } },
          grid: { color: 'rgba(255,255,255,0.05)' },
          ticks: { color: '#666' }
        },
        y: {
          grid: { color: 'rgba(255,255,255,0.05)' },
          ticks: {
            color: '#666',
            callback: (val) => val + '%'
          }
        }
      }
    }
  });
}

function updateStats() {
  const grid = document.getElementById('statsGrid');

  const returns = Object.entries(stockData).map(([ticker, data]) => {
    const startPrice = data[0]?.price || 1;
    const endPrice = data[data.length - 1]?.price || 1;
    const returnPct = ((endPrice - startPrice) / startPrice) * 100;
    return { ticker, returnPct };
  }).sort((a, b) => b.returnPct - a.returnPct);

  grid.innerHTML = returns.map(({ ticker, returnPct }) => {
    const info = SECTORS[ticker];
    const isPositive = returnPct >= 0;
    const sign = isPositive ? '+' : '';

    return `
      <div class="stat-card" style="border-left: 3px solid ${info.color}">
        <div class="ticker">${ticker}</div>
        <div class="return ${isPositive ? 'positive' : 'negative'}">
          ${sign}${returnPct.toFixed(2)}%
        </div>
      </div>
    `;
  }).join('');
}

// Initial load
fetchData();
</script>

</body>
</html>
